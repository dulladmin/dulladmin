<!-- Code generated by DullAdmin; DO NOT EDIT. -->

<template>
  <a-modal
    class="dulladmin-descriptions-dialog"
    v-model:visible="visible"
    hide-cancel
    @ok="handleModalOk"
    @cancel="handleModalCancel"
    @close="handleModalClose"
  >
    <template #title>
      \{{ $t('{{block.title.i18nKey}}') }}
      -
      \{{ $t('table.actions.show') }}
    </template>
    <div>
      <a-spin style="display: block" :loading="loading">
        <div
          class="arco-descriptions arco-descriptions-size-medium arco-descriptions-border"
        >
          <div class="arco-descriptions-body">
            <table class="arco-descriptions-table">
              <tbody>
              {{#each model.attributes}}
                <tr class="arco-descriptions-row">
                  <td
                    class="arco-descriptions-item-label arco-descriptions-item-label-block"
                  >
                    \{{ $t('{{i18nKey}}') }}
                  </td>
                  <td
                    class="arco-descriptions-item-value arco-descriptions-item-value-block"
                  >
                  {{#if collection}}
                    {{#if object}}
                    <DullTable
                      :data="store.{{name}}"
                      :meta="modelMetadata['{{name}}']"
                    />
                    {{else}}
                    <DullList
                      :data="store.{{name}}"
                      :meta="modelMetadata['{{name}}']"
                    />
                    {{/if}}
                  {{else}}
                    {{#if object}}
                    <DullDescriptions
                      :data="store.{{name}}"
                      :meta="modelMetadata['{{name}}']"
                    />
                    {{else}}
                    <DullData
                      :data="store.{{name}}"
                      :meta="modelMetadata['{{name}}']"
                    />
                    {{/if}}
                  {{/if}}
                  </td>
                </tr>
              {{/each}}
              </tbody>
            </table>
          </div>
        </div>
      </a-spin>
    </div>
  </a-modal>
</template>

<script lang="ts" setup>
  import { computed, ref, watch } from 'vue';
  import { useRoute } from 'vue-router';
  import type { DescData } from '@arco-design/web-vue/es/descriptions/interface';
  import { Model, get } from '{{ apiImportPath }}';
  import { useLoading } from '@/hooks';

  // props
  const props = defineProps<{
    visible: boolean;
    id: string;
  }>();
  const emits = defineEmits<{
    (e: 'update:visible', newValue: boolean): void;
  }>();

  // types
  type Desc = DescData & { dataIndex: string };

  // route
  const route = useRoute();
  const id = (route.params.id as string) ?? '';

  // model
  const modelMetadata: { [key: string]: any } = {
  {{#each model.attributes}}
    {{#if object.attributes}}
    {{name}}: {
      type: '{{type}}',
      {{#each object.attributes}}
      {{name}}: {
        type: '{{type}}',
        i18nKey: '{{i18nKey}}',
      },
      {{/each}}
    },
    {{else}}
    {{name}}: {
      type: '{{type}}',
      i18nKey: '{{i18nKey}}',
      {{#if optionals}}
      optionals: {
        {{#each optionals}}
        {{name}}: {
          i18nKey: '{{i18nKey}}',
        },
        {{/each}}
      },
      {{/if}}
    },
    {{/if}}
  {{/each}}
  };

  // descriptions - model
  const baseModel: Model = {
  {{#each model.attributes}}
    {{#if collection}}
    {{name}}: [],
    {{else}}
    {{name}}: undefined,
    {{/if}}
  {{/each}}
  };

  // descriptions - store
  const { loading, setLoading } = useLoading(true);
  const store = ref<Model>({
    ...baseModel
  });
  const fetchStore = async () => {
    setLoading(true);
    try {
      const { data } = await get(id, props.id);
      const { model } = data;

      if (model) {
        store.value = model;
      }
    } finally {
      setLoading(false);
    }
  };

  // descriptions - refresh
  const onDescriptionsRefresh = async () => {
    await fetchStore();
  };

  // modal - visible
  const visible = ref(false);
  watch(
    () => props.visible,
    (val) => {
      if (val) {
        visible.value = true;
        onDescriptionsRefresh();
      }
    }
  );

  // modal - ok
  const handleModalOk = () => {
    visible.value = false;
    emits('update:visible', false);
  };

  // modal - cancel
  const handleModalCancel = () => {
    visible.value = false;
    emits('update:visible', false);
  };

  // modal - close
  const handleModalClose = () => {
    store.value = {
      ...baseModel
    };
  };
</script>
